<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Python & React Chatbot</title>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script async src="https://ga.jspm.io/npm:es-module-shims@1.7.0/dist/es-module-shims.js"></script>
  <script type="importmap">
  {
    "imports": {
      "react": "https://esm.sh/react?dev",
      "react-dom/client": "https://esm.sh/react-dom/client?dev"
    }
  }
  </script>
  <style>
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f0f2f5; margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; }
    #chat-container { width: 400px; height: 600px; background: white; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); display: flex; flex-direction: column; overflow: hidden; }
    #messages-area { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
    
    .message { max-width: 80%; padding: 10px 15px; border-radius: 18px; font-size: 14px; line-height: 1.4; }
    .user { 
      background: linear-gradient(135deg, #0084ff, #00a2ff); 
      color: white; 
      align-self: flex-end;
      box-shadow: 0 4px 10px rgba(0, 132, 255, 0.2);
    }

    .bot { 
      background: #ffffff; 
      color: #333; 
      align-self: flex-start;
      border: 1px solid #e4e6eb;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
    }

    #chat-container { border: none; background: #f9f9f9; }
    #input-area { padding: 15px; border-top: 1px solid #eee; display: flex; gap: 10px; }
    input { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 20px; outline: none; }
    button { background: #0084ff; color: white; border: none; padding: 8px 15px; border-radius: 20px; cursor: pointer; font-weight: bold; }
    button:hover { background: #0073e6; }
    button:disabled { background: #ccc; cursor: not-allowed; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel" data-type="module">
    import React, { useState, useEffect, useRef } from 'react';
    import { createRoot } from 'react-dom/client';

    // --- CONFIGURATION ---
    // Î¤Î¿ Direct URL Î±Ï€ÏŒ Ï„Î¿ Hugging Face Space ÏƒÎ¿Ï…
    const API_BASE_URL = "https://sotch13-ai-chatbot-assistant.hf.space";

    function TypewriterText({ text }) {
      const [displayedText, setDisplayedText] = React.useState("");
      React.useEffect(() => {
        let i = 0;
        const timer = setInterval(() => {
          setDisplayedText((prev) => prev + text.charAt(i));
          i++;
          if (i >= text.length) clearInterval(timer);
        }, 20);
        return () => clearInterval(timer);
      }, [text]);
      return <span>{displayedText}</span>;
    }
    
    function App() {
      const [messages, setMessages] = useState([
        { sender: "bot", text: "Î“ÎµÎ¹Î± ÏƒÎ¿Ï…! Î¤Î¿ chatbot ÎµÎ¯Î½Î±Î¹ live ÏƒÏ„Î¿ Hugging Face. Î ÏÏ‚ Î¼Ï€Î¿ÏÏ Î½Î± Î²Î¿Î·Î¸Î®ÏƒÏ‰;" }
      ]);
      const [input, setInput] = useState("");
      const [isTyping, setIsTyping] = useState(false);
      const messagesEndRef = useRef(null);

      useEffect(() => {
        messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
      }, [messages]);

      const sendMessage = async () => {
        if (!input.trim() || isTyping) return;

        const userMsg = { sender: "user", text: input };
        setMessages(prev => [...prev, userMsg]);
        const currentInput = input;
        setInput("");
        setIsTyping(true);

        try {
          const response = await fetch(`${API_BASE_URL}/api/chat`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ text: currentInput })
          });
          
          const data = await response.json();
          setMessages(prev => [...prev, { sender: "bot", text: data.reply }]);
        } catch (error) {
          console.error("Fetch error:", error);
          setMessages(prev => [...prev, { sender: "bot", text: "âŒ Î£Ï†Î¬Î»Î¼Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚ Î¼Îµ Ï„Î¿ Hugging Face Space!" }]);
        } finally {
          setIsTyping(false);
        }
      };

      const clearChat = async () => {
        try {
          await fetch(`${API_BASE_URL}/api/clear`, { method: 'POST' });
          setMessages([{ sender: "bot", text: "Î— Î¼Î½Î®Î¼Î· ÎºÎ±Î¸Î±ÏÎ¯ÏƒÏ„Î·ÎºÎµ! Î•Î¯Î¼Î±Î¹ Î­Ï„Î¿Î¹Î¼Î¿Ï‚ Î³Î¹Î± Î½Î­Î± ÏƒÏ…Î¶Î®Ï„Î·ÏƒÎ·." }]);
        } catch (e) {
          alert("Î‘Ï€Î¿Ï„Ï…Ï‡Î¯Î± ÎºÎ±Î¸Î±ÏÎ¹ÏƒÎ¼Î¿Ï Î¼Î½Î®Î¼Î·Ï‚.");
        }
      };

      return (
        <>
          <button onClick={clearChat} style={{ marginBottom: '10px', cursor: 'pointer' }}>
            ğŸ—‘ï¸ ÎšÎ±Î¸Î±ÏÎ¹ÏƒÎ¼ÏŒÏ‚ ÎœÎ½Î®Î¼Î·Ï‚
          </button>
          <div id="chat-container">
            <div style={{ padding: '15px', background: '#0084ff', color: 'white', textAlign: 'center', fontWeight: 'bold' }}>
              Python AI Chat (Live)
            </div>
            <div id="messages-area">
              {messages.map((msg, index) => (
                <div key={index} className={`message ${msg.sender}`}>
                  {msg.sender === "bot" && index === messages.length - 1 ? (
                    <TypewriterText text={msg.text} />
                  ) : (
                    msg.text
                  )}
                </div>
              ))}
              <div ref={messagesEndRef} />
            </div>
            <div id="input-area">
              <input 
                value={input} 
                disabled={isTyping}
                onChange={(e) => setInput(e.target.value)}
                onKeyPress={(e) => e.key === 'Enter' && sendMessage()}
                placeholder={isTyping ? "Î¤Î¿ bot Î±Ï€Î±Î½Ï„Î¬ÎµÎ¹..." : "Î“ÏÎ¬ÏˆÎµ ÎºÎ¬Ï„Î¹..."}
              />
              <button onClick={sendMessage} disabled={isTyping || !input.trim()}>
                {isTyping ? "..." : "Î£Ï„ÎµÎ¯Î»Îµ"}
              </button>
            </div>
          </div>
        </>
      );
    }

    const root = createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>